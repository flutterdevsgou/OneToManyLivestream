# 📡 Stream App (React + WebSocket + FFmpeg + HLS)

A fully custom, self-hosted live streaming solution with React frontend and Node.js backend, using FFmpeg and HLS (no external services). Supports live camera streaming, multi-quality playback, and per-stream live chat.

---

## 📁 Project Structure

```
stream-app/
├── client/                     # React frontend
│   ├── src/
│   │   ├── components/
│   │   │   ├── HostStream.js   # Host camera + send stream via WebSocket
│   │   │   ├── ViewerPlayer.js # Video player with HLS and chat integration
│   │   │   └── ChatBox.js      # Per-stream chat UI using WebSocket
│   │   └── App.js              # Routes between Host/Viewer
│   └── public/
│       └── index.html          # React mount point
│
├── server/                     # Backend
│   ├── stream-server.js        # WebSocket server to pipe MediaRecorder -> FFmpeg
│   ├── chat-server.js          # WebSocket chat server with per-stream rooms
│   └── public/hls/             # HLS output (.m3u8 + .ts files generated by FFmpeg)
│
├── nginx.conf                  # RTMP + HLS server configuration (optional for advanced setups)
├── package.json                # Dependencies for backend services
└── README.md                   # Project instructions
```

---

## 🚀 Features

* 🎥 Host live stream from camera using browser (MediaRecorder + WebSocket)
* 🖥️ Viewer page with adaptive HLS playback (`hls.js`)
* 💬 Live chat per stream using WebSocket
* 🔁 Multi-quality video (480p, 720p, 1080p) via FFmpeg
* 🔐 Stream-based routing by ID (e.g. `/watch/stream123`)

---

## 🛠️ Technologies Used

* **Frontend**: React, hls.js, WebSocket
* **Backend**: Node.js, FFmpeg, Express (for static files)
* **Streaming**: HLS (`.m3u8` via FFmpeg), optional RTMP server via Nginx

---

## 🧪 Development Workflow

1. Run the WebSocket + FFmpeg server:

   ```bash
   node server/stream-server.js
   node server/chat-server.js
   ```

2. Start React frontend:

   ```bash
   cd client && npm install && npm start
   ```

3. Visit:

   * `http://localhost:3000/host` – Host camera stream
   * `http://localhost:3000/watch/stream123` – Viewer with chat

---

## 📦 FFmpeg Sample (for multiple quality outputs)

Use `ffmpeg` with `-var_stream_map` and `-master_pl_name` to generate HLS:

```bash
ffmpeg -re -i pipe:0 \
  -map 0:v -map 0:a -s:v:0 640x360 -b:v:0 800k \
  -map 0:v -map 0:a -s:v:1 1280x720 -b:v:1 2500k \
  -c:v libx264 -c:a aac \
  -f hls -hls_time 4 -hls_list_size 6 \
  -hls_segment_filename "server/public/hls/v%v/segment%d.ts" \
  -master_pl_name master.m3u8 \
  -var_stream_map "v:0,a:0 v:1,a:1" \
  server/public/hls/v%v/stream.m3u8
```

---

## 📺 Playback Example

Use `hls.js` in the viewer component to load the stream:

```js
hls.loadSource('http://localhost:3001/hls/master.m3u8');
hls.attachMedia(videoRef);
```

---

## ✅ To-Do / Improvements

* [ ] Add auth/token protection per stream
* [ ] Add recording option
* [ ] Add moderator/admin UI for chat
* [ ] Add viewer count per stream

---

## 📬 Questions?

Open an issue or message the maintainer.

---

MIT License © 2025
